# 세션 관리 및 RAG 메모리 리팩터 요약

- 날짜: 2025-11-02 12:00:00
- 작업: 세션관리 (2단어 이내)

## Q1. session id 관리 주체는 어디인가?

- LangChain이 session_id를 생성/보관하지 않음.
- 애플리케이션이 session_id를 정하고 전달.
- RunnableWithMessageHistory는 전달된 session_id로 `get_session_history_func`를 호출해 해당 히스토리를 조회/주입만 함.

## A1.

- `ask_question()`에서 인자로 받은 session_id를 `invoke(..., config={"configurable": {"session_id": session_id}})`로 전달.
- 실제 저장/조회는 `get_session_history_func`(본 레포에선 `app/core/memory.py`)가 책임.

## Q2. `memory.py` 리팩터링 및 DDB 테이블명 노출 우려

- 기존 코드에서 DDB 테이블명이 기본값으로 하드코딩되어 노출 우려.
- boto3 세션/리소스 초기화가 중복되고, 삭제 로직이 조건식 문자열로 작성되어 잠재적 오류 가능성 존재.

## A2. 적용한 변경사항

- 하드코딩된 테이블명 기본값 제거: `DDB_TABLE_FOR_RAG` 환경변수 미설정 시 예외 발생(의도치 않은 노출 방지).
- 세션/리소스 중앙화: `_get_boto3_session()`, `_get_dynamodb_resource()` 추가로 재사용 및 설정 일원화.
- 로컬 개발 지원: `DDB_ENDPOINT_URL` 지원(DynamoDB Local 등).
- 삭제 로직 개선: `Key('SessionId').eq(session_id)` 및 페이지네이션 처리, `table.key_schema` 기반으로 안전하게 키 구성하여 배치 삭제.
- 주석/Docstring 정리(영문) 및 타입 힌트 보강.

## 참고 환경 변수 목록(값 미포함)

- DDB_TABLE_FOR_RAG
- DDB_AWS_REGION
- DDB_AWS_ACCESS_KEY
- DDB_AWS_SECRET_ACCESS_KEY
- DDB_ENDPOINT_URL (선택)

## 품질 게이트

- Build: PASS (구문 오류 없음)
- Lint/Typecheck: FAIL (에디터 환경에서 의존성 미설치로 import 확인 실패; 런타임 환경에서 패키지 설치 필요)
- Tests: N/A (해당 모듈 단위 테스트 미구성)
